-- =================================================
-- AUTO FISHING (SAFE EQUIP FIRST)
-- DEFAULT ON + MINIMIZE ICON + X DESTROY
-- =================================================

-- SERVICES
local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")
local Camera = workspace.CurrentCamera

-- NET
local Net = RS:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")

local RE_Equip = Net:WaitForChild("RE/EquipToolFromHotbar")

-- MODULES
local FishingController = require(RS.Controllers.FishingController)
local AreaUtility = require(RS.Shared.AreaUtility)

-- CLEAN GUI
pcall(function()
    PlayerGui:FindFirstChild("AutoFishingGUI"):Destroy()
end)

-- GUI
local gui = Instance.new("ScreenGui", PlayerGui)
gui.Name = "AutoFishingGUI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,260,0,150)
frame.Position = UDim2.new(0.5,-130,0.5,-75)
frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,-70,0,35)
title.Position = UDim2.new(0,10,0,0)
title.Text = "ðŸŽ£ Auto Fishing"
title.Font = Enum.Font.GothamBold
title.TextSize = 15
title.TextColor3 = Color3.new(1,1,1)
title.BackgroundTransparency = 1
title.TextXAlignment = Enum.TextXAlignment.Left

local minimize = Instance.new("TextButton", frame)
minimize.Size = UDim2.new(0,28,0,28)
minimize.Position = UDim2.new(1,-64,0,4)
minimize.Text = "â–¢"
minimize.BackgroundTransparency = 1
minimize.TextColor3 = Color3.fromRGB(255,200,100)

local close = Instance.new("TextButton", frame)
close.Size = UDim2.new(0,28,0,28)
close.Position = UDim2.new(1,-32,0,4)
close.Text = "X"
close.BackgroundTransparency = 1
close.TextColor3 = Color3.fromRGB(255,90,90)

local status = Instance.new("TextLabel", frame)
status.Size = UDim2.new(1,-20,0,30)
status.Position = UDim2.new(0,10,0,40)
status.Text = "Status : INIT"
status.Font = Enum.Font.Gotham
status.TextSize = 13
status.TextColor3 = Color3.fromRGB(200,200,200)
status.BackgroundTransparency = 1
status.TextXAlignment = Enum.TextXAlignment.Left

local toggle = Instance.new("TextButton", frame)
toggle.Size = UDim2.new(1,-40,0,40)
toggle.Position = UDim2.new(0,20,0,80)
toggle.Font = Enum.Font.GothamBold
toggle.TextSize = 14
toggle.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", toggle).CornerRadius = UDim.new(0,10)

-- ICON
local icon = Instance.new("TextButton", gui)
icon.Size = UDim2.new(0,46,0,46)
icon.Position = UDim2.new(0.02,0,0.5,-23)
icon.Text = "ðŸŽ£"
icon.TextSize = 22
icon.Visible = false
icon.Active = true
icon.Draggable = true
icon.BackgroundColor3 = Color3.fromRGB(30,30,30)
icon.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", icon).CornerRadius = UDim.new(0,23)

-- STATE
local Enabled = true -- DEFAULT ON

local function Refresh()
    toggle.Text = Enabled and "AUTO FISHING : ON" or "AUTO FISHING : OFF"
    toggle.BackgroundColor3 = Enabled and Color3.fromRGB(0,170,100)
        or Color3.fromRGB(60,60,60)
    icon.BackgroundColor3 = toggle.BackgroundColor3
end

Refresh()

-- BUTTONS
toggle.MouseButton1Click:Connect(function()
    Enabled = not Enabled
    Refresh()
end)

minimize.MouseButton1Click:Connect(function()
    frame.Visible = false
    icon.Visible = true
end)

icon.MouseButton1Click:Connect(function()
    frame.Visible = true
    icon.Visible = false
end)

close.MouseButton1Click:Connect(function()
    Enabled = false
    gui:Destroy()
end)

-- AUTO EQUIP ROD (WAJIB SEBELUM FISH)
local function EquipRod()
    status.Text = "Status : Equip Rod"
    pcall(function()
        RE_Equip:FireServer(1)
    end)

    -- TUNGGU SAMPE CONTROLLER NGEH
    local timeout = os.clock() + 3
    repeat
        task.wait(0.1)
    until FishingController:GetCurrentGUID() or os.clock() > timeout
end

-- MAIN LOOP
task.spawn(function()
    EquipRod() -- <<<<<< KUNCI MASALAH DI SINI

    while task.wait(0.05) do
        if not Enabled then
            status.Text = "Status : OFF"
            continue
        end

        if FishingController:OnCooldown() then
            task.wait(0.05)
            continue
        end

        if FishingController:GetCurrentGUID() then
            status.Text = "Status : Clicking"
            FishingController:RequestFishingMinigameClick()
        else
            status.Text = "Status : Charging Rod"
            FishingController:RequestChargeFishingRod(
                Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2),
                true
            )
        end
    end
end)
