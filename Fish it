-- =========================================================
-- Auto Fishing Hub Compact FULL (Default ON hijau)
-- =========================================================

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- STATES (default ON)
local AutoFish = true
local AutoFavorite = true
local FavoriteRarity = "Mythic"
local AutoSell = true
local SellDelay = 30
local favoritedItems = {}

-- MODULES
local ItemUtility = require(ReplicatedStorage.Shared.ItemUtility)
local Replion = require(ReplicatedStorage.Packages.Replion)
local PlayerData = Replion.Client:WaitReplion("Data")

-- NETWORK EVENTS
local Events = {}
do
    local net = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net
    Events.favorite = net:WaitForChild("RE/FavoriteItem")
    Events.sell = net:WaitForChild("RF/SellAllItems")
end

-- RARITY SYSTEM
local RarityTiers = {Common=1,Uncommon=2,Rare=3,Epic=4,Legendary=5,Mythic=6,Secret=7}
local function getRarityValue(rarity) return RarityTiers[rarity] or 0 end
local function getFishRarity(itemData)
    if not itemData or not itemData.Data then return "Common" end
    return itemData.Data.Rarity or "Common"
end
local function isItemFavorited(uuid)
    local success, result = pcall(function()
        local items = PlayerData:GetExpect("Inventory").Items
        for _, item in ipairs(items or {}) do
            if item.UUID == uuid then return item.Favorited==true end
        end
        return false
    end)
    return success and result or false
end

-- AUTO FAVORITE
local function autoFavoriteByRarity()
    local targetValue = FavoriteRarity == "Mythic" and 6 or 7
    local favoritedCount = 0
    pcall(function()
        local items = PlayerData:GetExpect("Inventory").Items
        if not items or #items==0 then return end
        for _, item in ipairs(items) do
            local data = ItemUtility:GetItemData(item.Id)
            if data and data.Data then
                local rarityValue = getRarityValue(getFishRarity(data))
                if rarityValue >= targetValue and not isItemFavorited(item.UUID) and not favoritedItems[item.UUID] then
                    Events.favorite:FireServer(item.UUID)
                    favoritedItems[item.UUID] = true
                    favoritedCount = favoritedCount + 1
                    task.wait(0.2)
                end
            end
        end
    end)
end

local function favoriteAllNow()
    pcall(function()
        local items = PlayerData:GetExpect("Inventory").Items
        if not items then return end
        for _, item in ipairs(items) do
            local data = ItemUtility:GetItemData(item.Id)
            if data and data.Data then
                if not isItemFavorited(item.UUID) and not favoritedItems[item.UUID] then
                    Events.favorite:FireServer(item.UUID)
                    favoritedItems[item.UUID] = true
                    task.wait(0.2)
                end
            end
        end
    end)
end

-- AUTO SELL
local function simpleSell()
    pcall(function() Events.sell:InvokeServer() end)
end

-- AUTO LOOP FAVORITE & SELL
task.spawn(function()
    while true do
        if AutoFavorite then autoFavoriteByRarity() end
        if AutoSell then simpleSell() end
        task.wait(10)
    end
end)

----------------------------------------------------------------
-- GUI Compact
----------------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui", playerGui)
ScreenGui.Name = "Fisher_GUI_Compact"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 260, 0, 380)
Frame.Position = UDim2.new(0.7,0,0.25,0)
Frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Frame.Active = true
Frame.Draggable = true
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0,12)

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1,0,0,35)
Title.BackgroundColor3 = Color3.fromRGB(20,20,20)
Title.Text = "ğŸ£ Auto Fishing Hub"
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18

local CloseBtn = Instance.new("TextButton", Frame)
CloseBtn.Size = UDim2.new(0,28,0,28)
CloseBtn.Position = UDim2.new(1,-32,0,2)
CloseBtn.BackgroundColor3 = Color3.fromRGB(255,80,80)
CloseBtn.Text = "X"
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextColor3 = Color3.fromRGB(255,255,255)
CloseBtn.TextSize = 18
CloseBtn.BorderSizePixel = 0

local MinBtn = Instance.new("TextButton", Frame)
MinBtn.Size = UDim2.new(0,28,0,28)
MinBtn.Position = UDim2.new(1,-70,0,2)
MinBtn.BackgroundColor3 = Color3.fromRGB(80,160,255)
MinBtn.Text = "-"
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextColor3 = Color3.fromRGB(255,255,255)
MinBtn.TextSize = 18
MinBtn.BorderSizePixel = 0

local hiddenElements = {}

local function updateButtonVisual(btn,state)
    btn.BackgroundColor3 = state and Color3.fromRGB(40,180,60) or Color3.fromRGB(180,50,50)
    btn.Text = string.gsub(btn.Text, ": ON", ": "..(state and "ON" or "OFF"))
end

local function CreateToggle(name,posY,defaultVar)
    local btn = Instance.new("TextButton", Frame)
    btn.Size = UDim2.new(0.9,0,0,35)
    btn.Position = UDim2.new(0.05,0,0,posY)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Text = name.." : ON"
    btn.BackgroundColor3 = Color3.fromRGB(40,180,60)
    table.insert(hiddenElements, btn)
    btn.MouseButton1Click:Connect(function()
        defaultVar[1] = not defaultVar[1]
        updateButtonVisual(btn, defaultVar[1])
    end)
    return btn
end

local function CreateButton(name,posY,callback)
    local btn = Instance.new("TextButton", Frame)
    btn.Size = UDim2.new(0.9,0,0,35)
    btn.Position = UDim2.new(0.05,0,0,posY)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
    btn.Text = name
    table.insert(hiddenElements, btn)
    btn.MouseButton1Click:Connect(callback)
    return btn
end

local function CreateInput(name,posY,default,callback)
    local input = Instance.new("TextBox", Frame)
    input.Size = UDim2.new(0.9,0,0,35)
    input.Position = UDim2.new(0.05,0,0,posY)
    input.TextSize = 16
    input.Font = Enum.Font.Gotham
    input.TextColor3 = Color3.fromRGB(255,255,255)
    input.PlaceholderText = name
    input.Text = tostring(default)
    input.BackgroundColor3 = Color3.fromRGB(80,80,80)
    table.insert(hiddenElements, input)

    input.FocusLost:Connect(function(enter)
        if enter then
            local val = tonumber(input.Text)
            if val and val >= 1 and val <= 300 then
                callback(val)
            else input.Text = tostring(default) end
        end
    end)
    return input
end

-- Minimize Logic
local minimized=false
MinBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    for _,obj in ipairs(hiddenElements) do
        obj.Visible = not minimized
    end
    Frame.Size = minimized and UDim2.new(0,Frame.Size.X.Offset,0,40) or UDim2.new(0,Frame.Size.X.Offset,0,380)
    MinBtn.Text = minimized and "ğŸ‰" or "-"
end)

CloseBtn.MouseButton1Click:Connect(function()
    AutoFish=false
    AutoFavorite=false
    AutoSell=false
    ScreenGui:Destroy()
end)

----------------------------------------------------------------
-- AUTO FISH REMOTES
----------------------------------------------------------------
local baseNet = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
local RF_Charge = baseNet:FindFirstChild("RF/ChargeFishingRod")
local RF_Start = baseNet:FindFirstChild("RF/RequestFishingMinigameStarted")
local RE_Complete = baseNet:FindFirstChild("RE/FishingCompleted")
local RE_Equip = baseNet:FindFirstChild("RE/EquipToolFromHotbar")
local busy=false
local TELEPORT_POS = Vector3.new(-3704.14, -135.07, -889.28)

local function prepareFishing()
    local char = player.Character or player.CharacterAdded:Wait()
    if char:FindFirstChild("HumanoidRootPart") then char.HumanoidRootPart.CFrame = CFrame.new(TELEPORT_POS) task.wait(1) end
    if RE_Equip then RE_Equip:FireServer(1) task.wait(1) end
end

local function doFishNew()
    if busy or not AutoFish then return end
    busy=true
    if not RF_Charge or not RF_Start or not RE_Complete then
        warn("Fishing remotes missing!")
        busy=false
        return
    end
    RF_Charge:InvokeServer(tick())
    task.wait(0.2)
    RF_Start:InvokeServer(math.random(-2,2), math.random(-2,2))
    task.wait(2+math.random())
    RE_Complete:FireServer()
    busy=false
end

task.spawn(function()
    prepareFishing()
    while true do
        task.wait(0.3)
        if AutoFish then doFishNew() end
    end
end)

----------------------------------------------------------------
-- CREATE BUTTONS/TOGGLES
----------------------------------------------------------------
local y=50
local tAutoFish = {AutoFish}
local tAutoFavorite = {AutoFavorite}
local tAutoSell = {AutoSell}

CreateToggle("Auto Fish", y,tAutoFish); y=y+40
CreateToggle("Auto Favorite", y,tAutoFavorite); y=y+40
CreateButton("â­ Favorite by Rarity Now", y,function() task.spawn(autoFavoriteByRarity) end); y=y+40
CreateButton("â­ Favorite All Now (0-7)", y,function() task.spawn(favoriteAllNow) end); y=y+40
CreateToggle("ğŸ’° Auto Sell", y,tAutoSell); y=y+40
CreateInput("Sell Delay (1-300s)", y,SellDelay,function(val) SellDelay=val end); y=y+40
CreateButton("ğŸ’° Sell All Now", y,simpleSell)

----------------------------------------------------------------
-- ANTI AFK
----------------------------------------------------------------
local VirtualUser = game:GetService('VirtualUser')
player.Idled:Connect(function()
	VirtualUser:CaptureController()
	VirtualUser:ClickButton2(Vector2.new())
end)


print("ğŸ£ Auto Fishing Hub COMPACT Loaded! Semua toggle default ON (hijau).")
